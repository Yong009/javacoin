<html>

<head>
	 <meta charset="UTF-8">
	<title>글쓰기</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>



		#wrap-boardDetail{

		}



    </style>
</head>




<body id="wrap-boardDetail" >
	<div id="header"></div>
	  <div  >
	  <h3 >글쓰기</h3>
	  <input id="content2" type="text" hidden><br/><br/>
	  <label for="title" >제목</label><br/><br/>
      <input id="title" type="text"  ><br/><br/>
      <label for="id" >작성자</label><br/><br/>
      <input id="id" type="text" readonly ><br/><br/>
      <label id="content2" >내용</label><br/><br/>
      <textarea id="content"  cols="60" rows="10" placeholder="여기에다가 글 남겨주세요!!" ></textarea>
	  <div id="update" >
	  	<button id="prev" type="button" >이전</button>
	  </div>

	</div>

	<div>
		<h3 >댓글</h3>
		<label for="commentText" >내용</label>
      	<input id="commentText" type="text" >
      	<button id="insertBtn" type="button" >등록</button>
		<table >
			<thead>
				<th>번호</th>
				<th>작성자</th>
				<th>댓글 내용</th>
				<th>날짜</th>
				<th>좋아요</th>
				<th>댓글삭제</th>
			</thead>
			<tbody id="Tb" ></tbody>



		</table>


	</div>



	<div id="footer"></div>

	<script>

		 $('#header').load('header.html')
	     $('#footer').load('footer.html')

	     var username = '[[${user}]]';

		 var seq2 = localStorage.getItem('seq');

	     var seq = JSON.parse(seq2);

		 var board = {
			seq : seq.seq
		 }

		 $.ajax({
			url:"/boardDetailAjax",
			type:"POST",
			data:JSON.stringify(board),
			dataType:"json",
			contentType:"application/json",
			success:function(result){

				console.log(result);

				$('#title').val(result[0].title)
				$('#id').val(result[0].writer)
				$('#content').val(result[0].textWrite)

				if(username == result[0].writer || username == 'goo'){

					console.log(username)
					console.log(result[0].writer)

					var btn = $('<button type="button" id="updateBtn" class="btn-gradient green" style="margin-left:15px; font-weight: bold;">').text('수정하기')
 					var btn2 = $('<button type="button" id="deleteBtn" class="btn-gradient blue" style="margin-left:15px; font-weight: bold;">').text('삭제하기')
				 	$('#update').append(btn);
					$('#update').append(btn2);



					 $('#updateBtn').on('click',function(){


						 var title2 = $('#title').val()
						 var content2 = $('#content').val()

						 var board2 = {
								 seq : seq.seq,
							 	 title : title2,
								 textWrite : content2
						 	}

						 console.log(board2)

						 $.ajax({
							url:"/updateBoard",
							type:"POST",
							data:JSON.stringify(board2),
							dataType:"json",
							contentType:"application/json",
							success:function(result){



								}
							})

							alert("게시글 수정 성공!!!")
						 })

						  $('#deleteBtn').on('click',function(){



						 var board3 = {
								 seq : seq.seq,

						 	}



						 $.ajax({
							url:"/deleteBoard",
							type:"POST",
							data:JSON.stringify(board3),
							dataType:"json",
							contentType:"application/json",
							success:function(result){



								}
							})

							alert("게시글 삭제 성공!!!")
						 })


				}

			}
		 })


		 var board4 = {

		 		boardSeq:seq.seq
		 	}

		 $.ajax({
			url:"/comment",
			type:"POST",
			data:JSON.stringify(board4),
			dataType:"json",
			contentType:"application/json",
			success:function(result){

				 var tbody = $('#Tb');
				 tbody.empty();
				 console.log(result);
				 $.each(result,function(i, item){

				 	var row = $('<tr style="border-bottom:1px solid;">');

				 	var td1 = $('<td class="center" ">').text(item.seq);
				 	row.append(td1);

				 	var td2 = $('<td class="center"">').text(item.writer);
				 	row.append(td2);

				 	var td3 = $('<td class="center"">').text(item.textWrite);
				 	row.append(td3);


				 	var td6 = $('<td class="center"">').text(item.writeDate);
				 	row.append(td6);

				 	var td4 = $('<td class="center" ">').text(item.heart);
				 	row.append(td4);
					if(item.writer == username || username == 'goo'){
						var td5 = $('<td class="center" ">');
						var link = $('<a style="color:red">').attr('href','#').text("X");
						td5.append(link);
						row.append(td5);

						link.on('click',function(event){
							event.preventDefault();

							var board5 = {
									seq : item.seq
								}

							$.ajax({
								url:"/deleteComment",
								type:"POST",
								data:JSON.stringify(board5),
								dataType:"json",
								contentType:"application/json",
								success:function(result){

								}


							})

							alert("댓글 삭제 성공!!!")
							window.location.href = "/board";
					 	})
					}
					else{
						var td5 = $('<td class="center">').text('');
						row.append(td5);
					}


				 	tbody.append(row);


				 })
			}

		 })

		$('#insertBtn').on('click',function(){

		    var commentText = $('#commentText').val()

		 	var comment3 = {

		 		textWrite : commentText,
		 		writer: username,
		 		boardSeq: seq.seq,
		 }

			$.ajax({
				url:"/insertComment",
				type:"POST",
				data:JSON.stringify(comment3),
				dataType:"json",
				contentType:"application/json",
				success:function(result){


					 var board4 = {

						 		boardSeq:seq.seq
						 	}

						 $.ajax({
							url:"/comment",
							type:"POST",
							data:JSON.stringify(board4),
							dataType:"json",
							contentType:"application/json",
							success:function(result){

								 var tbody = $('#Tb');

								 $.each(result,function(i, item){

								 	var row = $('<tr style="border-bottom:1px solid;">');

								 	var td1 = $('<td class="center">').text(item.seq);
								 	row.append(td1);

								 	 var td2 = $('<td class="center">').text(item.writer);
								 	row.append(td2);

								 	var td3 = $('<td class="center">').text(item.textWrite);
								 	row.append(td3);

								 	var td6 = $('<td class="center">').text(item.writeDate);
								 	row.append(td6);

								 	var td4 = $('<td class="center">').text(item.heart);
								 	row.append(td4);
									if(item.writer == username || username == 'goo'){
										var td5 = $('<td class="center">');
										var link = $('<a style="color:red">').attr('href','#').text("X");
										td5.append(link);
										row.append(td5);

										link.on('click',function(event){
											event.preventDefault();

											var board5 = {
													seq : item.seq
												}

											$.ajax({
												url:"/deleteComment",
												type:"POST",
												data:JSON.stringify(board5),
												dataType:"json",
												contentType:"application/json",
												success:function(result){

												}


											})


									 	})
									}


								 	tbody.append(row);


								 })
							}

						 })

				}

			})
			console.log(username);
			alert("댓글 등록 성공!!!")

		})





			$('#prev').on('click',function(){

				window.location.href = "/board";
			})


    </script>
</body>

</html>