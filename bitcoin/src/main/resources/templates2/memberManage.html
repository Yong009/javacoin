<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>

		#wrap-memberManage{

		}

    </style>
</head>
<body id="wrap-memberManage">
  <div id="header"></div>

  <div >
      <h4 >회원 관리</h4>
      <div >
          <table>
              <thead >
              <tr >
                  <th>id</th>
                  <th>자동매매</th>
                  <th>off</th>
                  <th>회원탈퇴</th>
              </tr>
              </thead>
              <tbody id="Tb" >

              </tbody>
          </table>
          <div id="pagination" ></div>
      </div>
       <div id="footer"></div>
  <script>
    $('#header').load('header.html');
   //$('#footer').load('footer.html');

    $.ajax({
        url:"/memberAll",
        type:"POST",
        contentType:"application/json",
        dataType:"json",
        success:function(result){
           // console.log(result);
            var tbody = $('#Tb');
            $.each(result,function(i,item){
                var row= $('<tr>');
                var td1 = $('<td class="center">').text(result[i].id);
                row.append(td1);
                if(result[i].auto=='Y'){
                    var td2 = $('<td class="center" style="color:red">').text("사용")

                }else{
                    var td2 = $('<td class="center" style="color:blue">').text("미사용")
                }
                row.append(td2);

                var stopBtn = $('<buttonn type="button" id="stopBtn" class="btn-gradient blue mini" style="width:30px; height: 15px;">').text('끄기')
                var td3 = $('<td class="center">').append(stopBtn);
                row.append(td3);

				stopBtn.on('click',function(){
					var id2 = result[i].id
                    var member2 = {
                        id : id2
                    }

					   $.ajax({
	                        url:"/manageAuto",
	                        type:"POST",
	                        data:JSON.stringify(member2),
	                        dataType: "json",
	                        contentType:"application/json",
	                        success: function(result){



	                        }
	                    })

	                     alert('자동매매 끄기 성공!!!')
				})


                var deleteBtn = $('<buttonn type="button" id="deleteBtn" class="btn-gradient blue mini" style="width:30px; height: 15px;">').text('탈퇴')
                var td4 = $('<td class="center">').append(deleteBtn);
                row.append(td4);

                deleteBtn.on('click',function(){

                    var id2 = result[i].id
                    var member2 = {
                        id : id2
                    }

                    $.ajax({
                        url:"/deleteMember",
                        type:"POST",
                        data:JSON.stringify(member2),
                        dataType: "json",
                        contentType:"application/json",
                        success: function(result){



                        }
                    })

                    alert('탈퇴 성공!!!')

                })


                tbody.append(row);
            })
        }
    })


	var max;

    $.ajax({
		url:"/memberMax",
		type:"GET",
		dataType:"json",
		contentType:"application/json",
		success:function(result){

			if(result <= 10 || result != 0){
				max = 1;
			}else{
				max = Math.floor((result/10)+1);
			}

			$('#pagination').empty();

				for(var i = 1; i<= max; i++){
					var pageButton = $('<button class="btn-gradient purple mini" id='+i+'>').text(i);

					pageButton.click(function(){

						var selectedPage = $(this).text();

						var vo = {
							page : selectedPage
						}

						pageButton.css('font-weight','bold');

						$.ajax({
							url:"/memberListAjax2",
							type:"POST",
							dataType:"json",
							data:JSON.stringify(vo),
							contentType:"application/json",
							success:function(result2){

								   var tbody = $('#Tb');
								   tbody.empty();
						            $.each(result2,function(i,item){
						                var row= $('<tr>');
						                var td1 = $('<td class="center">').text(result2[i].id);
						                row.append(td1);
						                if(result2[i].auto=='Y'){
						                    var td2 = $('<td class="center" style="color:red">').text("사용")

						                }else{
						                    var td2 = $('<td class="center" style="color:blue">').text("미사용")
						                }
						                row.append(td2);

						                var stopBtn = $('<buttonn type="button" id="stopBtn" class="btn-gradient blue mini" style="width:30px; height: 15px;">').text('끄기')
						                var td3 = $('<td class="center">').append(stopBtn);
						                row.append(td3);

										stopBtn.on('click',function(){
											var id2 = result2[i].id
						                    var member2 = {
						                        id : id2
						                    }

											   $.ajax({
							                        url:"/manageAuto",
							                        type:"POST",
							                        data:JSON.stringify(member2),
							                        dataType: "json",
							                        contentType:"application/json",
							                        success: function(result3){



							                        }
							                    })

							                     alert('자동매매 끄기 성공!!!')
										})


						                var deleteBtn = $('<buttonn type="button" id="deleteBtn" class="btn-gradient blue mini" style="width:30px; height: 15px;">').text('탈퇴')
						                var td4 = $('<td class="center">').append(deleteBtn);
						                row.append(td4);

						                deleteBtn.on('click',function(){

						                    var id2 = result2[i].id
						                    var member2 = {
						                        id : id2
						                    }

						                    $.ajax({
						                        url:"/deleteMember",
						                        type:"POST",
						                        data:JSON.stringify(member2),
						                        dataType: "json",
						                        contentType:"application/json",
						                        success: function(result4){


						                        }
						                    })

						                    alert('탈퇴 성공!!!')

						                })
						                tbody.append(row);
						            })

							}
						})

					})
					$('#pagination').append(pageButton);
				}
		}


    })
  </script>
</body>
</html>